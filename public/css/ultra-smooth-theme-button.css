/* 
 * Bouton de thème ultra-fluide et moderne - Version 2025
 * Basé sur les meilleures pratiques UX Motion Design
 * Physique de ressort, micro-interactions, animations délicieuses
 */

/* Bouton principal flottant */
#ultra-theme-toggle {
    position: fixed !important;
    bottom: 24px !important;
    right: 24px !important;
    z-index: 10000 !important;
    width: 56px !important;
    height: 56px !important;
    border-radius: 50% !important;
    border: none !important;
    cursor: pointer !important;
    
    /* Arrière-plan glassmorphisme premium */
    background: rgba(255, 255, 255, 0.08) !important;
    backdrop-filter: blur(20px) saturate(1.8) !important;
    -webkit-backdrop-filter: blur(20px) saturate(1.8) !important;
    
    /* Ombres multiples pour effet de profondeur */
    box-shadow: 
        0 2px 16px -2px rgba(0, 0, 0, 0.08),
        0 8px 32px -4px rgba(0, 0, 0, 0.06),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
        
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    outline: none !important;
    overflow: visible !important;
    
    /* Animation ultra-fluide avec physique de ressort */
    transition: 
        transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275),
        box-shadow 0.25s cubic-bezier(0.25, 0.8, 0.25, 1),
        background 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
        
    transform: scale(1) translateZ(0) !important;
    will-change: transform, box-shadow !important;
}

/* États interactifs avec micro-animations */
#ultra-theme-toggle:hover {
    transform: scale(1.08) translateZ(0) !important;
    box-shadow: 
        0 4px 20px -2px rgba(0, 0, 0, 0.12),
        0 12px 40px -4px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
    background: rgba(255, 255, 255, 0.12) !important;
}

#ultra-theme-toggle:active {
    transform: scale(0.96) translateZ(0) !important;
    transition-duration: 0.1s !important;
    box-shadow: 
        0 1px 8px -1px rgba(0, 0, 0, 0.1),
        0 4px 16px -2px rgba(0, 0, 0, 0.06),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.15) !important;
}

#ultra-theme-toggle:focus-visible {
    outline: none !important;
    box-shadow: 
        0 4px 20px -2px rgba(0, 0, 0, 0.12),
        0 12px 40px -4px rgba(0, 0, 0, 0.08),
        0 0 0 3px rgba(99, 102, 241, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
}

/* Container des icônes avec rotation fluide */
.ultra-icon-container {
    position: relative !important;
    width: 28px !important;
    height: 28px !important;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    transform-origin: center !important;
}

#ultra-theme-toggle:hover .ultra-icon-container {
    transform: rotate(15deg) !important;
}

/* Icônes avec animations individuelles */
.theme-icon {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    width: 24px !important;
    height: 24px !important;
    transform: translate(-50%, -50%) !important;
    opacity: 0 !important;
    transition: 
        opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
        transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    color: rgba(255, 255, 255, 0.9) !important;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1)) !important;
}

.theme-icon.active {
    opacity: 1 !important;
    transform: translate(-50%, -50%) scale(1) !important;
}

.theme-icon.inactive {
    opacity: 0 !important;
    transform: translate(-50%, -50%) scale(0.8) rotate(90deg) !important;
}

/* Icône soleil - Mode clair */
.sun-icon {
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23FCD34D'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z' /%3E%3C/svg%3E") no-repeat center !important;
    background-size: contain !important;
}

/* Icône lune - Mode sombre */
.moon-icon {
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236366F1'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z' /%3E%3C/svg%3E") no-repeat center !important;
    background-size: contain !important;
}

/* Effet de particules pour les transitions */
.magic-particles {
    position: absolute !important;
    width: 100% !important;
    height: 100% !important;
    pointer-events: none !important;
    overflow: visible !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
}

.magic-particles.active {
    opacity: 1 !important;
}

.particle {
    position: absolute !important;
    width: 2px !important;
    height: 2px !important;
    background: rgba(255, 255, 255, 0.8) !important;
    border-radius: 50% !important;
    animation: sparkle-float 1.5s ease-out infinite !important;
}

/* Animations de particules */
@keyframes sparkle-float {
    0% {
        opacity: 0;
        transform: translateY(0) scale(0);
    }
    20% {
        opacity: 1;
        transform: translateY(-2px) scale(1);
    }
    100% {
        opacity: 0;
        transform: translateY(-8px) scale(0.5);
    }
}

/* Positionnement des particules */
.particle:nth-child(1) { 
    top: 15%; 
    left: 25%; 
    animation-delay: 0s; 
    animation-duration: 1.2s; 
}

.particle:nth-child(2) { 
    top: 25%; 
    right: 20%; 
    animation-delay: 0.2s; 
    animation-duration: 1.6s; 
}

.particle:nth-child(3) { 
    bottom: 30%; 
    left: 30%; 
    animation-delay: 0.4s; 
    animation-duration: 1.4s; 
}

.particle:nth-child(4) { 
    bottom: 20%; 
    right: 35%; 
    animation-delay: 0.6s; 
    animation-duration: 1.8s; 
}

/* Animation d'entrée du bouton */
#ultra-theme-toggle {
    animation: ultra-entrance 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
}

@keyframes ultra-entrance {
    0% {
        transform: scale(0) translateZ(0) rotate(-180deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.1) translateZ(0) rotate(-90deg);
        opacity: 0.8;
    }
    100% {
        transform: scale(1) translateZ(0) rotate(0deg);
        opacity: 1;
    }
}

/* Pulsation subtile en mode veille */
#ultra-theme-toggle:not(:hover):not(:active) {
    animation: gentle-pulse 4s ease-in-out infinite !important;
}

@keyframes gentle-pulse {
    0%, 100% {
        transform: scale(1) translateZ(0);
        opacity: 0.95;
    }
    50% {
        transform: scale(1.02) translateZ(0);
        opacity: 1;
    }
}

/* Thèmes spécifiques */
[data-theme="dark"] #ultra-theme-toggle {
    background: rgba(15, 23, 42, 0.15) !important;
    box-shadow: 
        0 2px 16px -2px rgba(0, 0, 0, 0.2),
        0 8px 32px -4px rgba(0, 0, 0, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
}

[data-theme="light"] #ultra-theme-toggle {
    background: rgba(255, 255, 255, 0.2) !important;
    box-shadow: 
        0 2px 16px -2px rgba(0, 0, 0, 0.05),
        0 8px 32px -4px rgba(0, 0, 0, 0.03),
        0 0 0 1px rgba(0, 0, 0, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.4) !important;
}

/* Responsive design optimisé */
@media (max-width: 768px) {
    #ultra-theme-toggle {
        width: 52px !important;
        height: 52px !important;
        bottom: 20px !important;
        right: 20px !important;
    }
    
    .ultra-icon-container {
        width: 26px !important;
        height: 26px !important;
    }
    
    .theme-icon {
        width: 22px !important;
        height: 22px !important;
    }
}

/* Accessibilité - Respect des préférences utilisateur */
@media (prefers-reduced-motion: reduce) {
    #ultra-theme-toggle,
    .ultra-icon-container,
    .theme-icon,
    .magic-particles,
    .particle {
        animation: none !important;
        transition: none !important;
    }
    
    #ultra-theme-toggle:hover {
        transform: scale(1.05) translateZ(0) !important;
    }
}

/* Mode haut contraste */
@media (prefers-contrast: high) {
    #ultra-theme-toggle {
        background: rgba(0, 0, 0, 0.8) !important;
        border: 2px solid #ffffff !important;
        box-shadow: 0 0 0 2px #000000 !important;
    }
    
    .theme-icon {
        filter: none !important;
        color: #ffffff !important;
    }
}

/* Animation de rotation lors du changement de thème */
.theme-switching .ultra-icon-container {
    animation: theme-switch-rotation 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
}

@keyframes theme-switch-rotation {
    0% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.2); }
    100% { transform: rotate(360deg) scale(1); }
}

/* Effet de "respiration" pour attirer l'attention */
#ultra-theme-toggle.attention {
    animation: attention-breath 2s ease-in-out 3 !important;
}

@keyframes attention-breath {
    0%, 100% {
        transform: scale(1) translateZ(0);
        box-shadow: 
            0 2px 16px -2px rgba(99, 102, 241, 0.2),
            0 8px 32px -4px rgba(99, 102, 241, 0.15),
            0 0 0 1px rgba(99, 102, 241, 0.3) !important;
    }
    50% {
        transform: scale(1.05) translateZ(0);
        box-shadow: 
            0 4px 24px -2px rgba(99, 102, 241, 0.4),
            0 12px 48px -4px rgba(99, 102, 241, 0.25),
            0 0 0 2px rgba(99, 102, 241, 0.5) !important;
    }
}
